<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<title>Ø¯Ø§Ø±ÙˆØ®Ø§Ù†Ù‡ Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù† Ø§Ù…Ø§Ù… Ø­Ø³ÛŒÙ† (Ø¹)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
  font-family: Tahoma, sans-serif;
  direction: rtl;
  margin: 0;
  padding: 0;
  background: linear-gradient(135deg, #74b9ff, #81ecec);
  color: #2d3436;
}
header {
  background: #0984e3;
  color: #fff;
  text-align: center;
  padding: 20px;
  font-size: 22px;
  font-weight: bold;
}
.box {
  max-width: 800px;
  background: #fff;
  margin: 20px auto;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 8px 16px rgba(0,0,0,.1);
}
input, button, textarea, select {
  width: 100%;
  margin: 8px 0;
  padding: 10px;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid #ccc;
}
button {
  background: linear-gradient(to right, #00b894, #55efc4);
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: .3s;
  border: none;
}
button:hover { transform: scale(1.03); }
.hidden { display: none; }
.table-wrap {
  overflow-x: auto;
  border: 2px solid #ccc;
  border-radius: 10px;
  padding: 10px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  table-layout: fixed;
  font-size: 15px;
}
th {
  background: #dfe6e9;
  font-weight: bold;
  text-align: center;
}
td {
  text-align: center;
  font-family: Tahoma, sans-serif;
}
td:nth-child(1) { text-align: right; width: 22%; }
td:nth-child(2), td:nth-child(3) { width: 12%; }
td:nth-child(4) { width: 18%; }
td:nth-child(5) { width: 20%; font-weight: bold; }
td:nth-child(6) { width: 10%; }

.statusLow {
  color: #fff;
  background-color: #d63031;
  animation: blinkRed 1.2s linear infinite;
}
.statusExpired {
  color: #000;
  background-color: #f1c40f;
  animation: blinkYellow 1.2s linear infinite;
}
.statusBoth {
  color: #fff;
  background: linear-gradient(45deg, #d63031, #f1c40f);
  animation: blinkBoth 1.2s linear infinite;
}
@keyframes blinkRed {
  0%, 100% { background-color: #d63031; }
  50% { background-color: #e74c3c; }
}
@keyframes blinkYellow {
  0%, 100% { background-color: #f1c40f; }
  50% { background-color: #ffeaa7; }
}
@keyframes blinkBoth {
  0%, 100% { background: linear-gradient(45deg, #d63031, #f1c40f); }
  50% { background: linear-gradient(45deg, #e74c3c, #ffeaa7); }
}
.footer {
  text-align: center;
  margin-top: 30px;
  font-size: 14px;
  opacity: .9;
}
.footer a {
  margin: 0 10px;
  text-decoration: none;
  color: #2d3436;
  font-weight: bold;
  animation: blink 1s infinite;
}
.footer img {
  width: 20px;
  vertical-align: middle;
}
@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}
</style>
</head>
<body>

<header>Ø¯Ø§Ø±ÙˆØ®Ø§Ù†Ù‡ Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù† Ø§Ù…Ø§Ù… Ø­Ø³ÛŒÙ† (Ø¹)</header>

<div class="box" id="home-page">
  <button onclick="show('login-box')">ğŸ“¦ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†Ø¨Ø§Ø±</button>
  <button onclick="show('report-form')">ğŸ“ Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´ Ú©Ø³Ø±ÛŒ</button>
</div>

<div class="box hidden" id="report-form">
  <input id="fname" placeholder="Ù†Ø§Ù…" required>
  <input id="lname" placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ" required>
  <input id="reportText" placeholder="Ù†Ø§Ù… Ø¯Ø§Ø±ÙˆÛŒ Ø¯Ø§Ø±Ø§ÛŒ Ú©Ø³Ø±ÛŒ" required>
  <button onclick="submitReport()">ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ú¯Ø²Ø§Ø±Ø´</button>
  <button onclick="show('home-page')">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>

<div class="box hidden" id="login-box">
  <input id="login-username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ">
  <input id="login-password" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
  <button onclick="login()">ÙˆØ±ÙˆØ¯</button>
  <button onclick="show('home-page')">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>

<div class="box hidden" id="main-menu">
  <button onclick="show('main-app')">ğŸ’Š ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø§Ù†Ø¨Ø§Ø±</button>
  <button id="admin-reports-btn" class="hidden" onclick="loadReports();show('admin-reports')">ğŸ“„ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø±ÛŒ</button>
  <button id="add-user-btn" class="hidden" onclick="show('add-user-box')">â• ØªØ¹Ø±ÛŒÙ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</button>
  <button onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
</div>

<div class="box hidden" id="add-user-box">
  <input id="new-username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¬Ø¯ÛŒØ¯">
  <input id="new-password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
  <select id="new-role">
    <option value="user">Ú©Ø§Ø±Ø¨Ø± Ù…Ø¹Ù…ÙˆÙ„ÛŒ</option>
    <option value="admin">Ù…Ø¯ÛŒØ±</option>
  </select>
  <button onclick="addUser()">â• Ø§ÙØ²ÙˆØ¯Ù†</button>
  <button onclick="show('main-menu')">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>

<div class="box hidden" id="main-app">
  <form id="drug-form">
    <input id="name" placeholder="Ù†Ø§Ù… Ø¯Ø§Ø±Ùˆ" required>
    <input id="quantity" type="number" placeholder="ØªØ¹Ø¯Ø§Ø¯" required>
    <input id="minQuantity" type="number" placeholder="Ø­Ø¯Ø§Ù‚Ù„ Ù…Ø¬Ø§Ø²" required>
    <input id="expiry" type="date" required>
    <button type="submit">â• Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø§Ø±Ùˆ</button>
  </form>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Ù†Ø§Ù…</th><th>ØªØ¹Ø¯Ø§Ø¯</th><th>Ø­Ø¯Ø§Ù‚Ù„</th><th>Ø§Ù†Ù‚Ø¶Ø§</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>Ø­Ø°Ù</th>
        </tr>
      </thead>
      <tbody id="drug-table"></tbody>
    </table>
  </div>
  <button onclick="show('main-menu')">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>

<div class="box hidden" id="admin-reports">
  <div class="table-wrap">
    <table>
      <thead>
        <tr><th>Ù†Ø§Ù…</th><th>Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th><th>Ù†Ø§Ù… Ø¯Ø§Ø±Ùˆ</th><th>Ø²Ù…Ø§Ù†</th></tr>
      </thead>
      <tbody id="reports-table"></tbody>
    </table>
  </div>
  <button onclick="exportReports()">ğŸ“Š Ø®Ø±ÙˆØ¬ÛŒ CSV</button>
  <button onclick="show('main-menu')">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>

<div class="footer">
  Ø·Ø±Ø§Ø­ÛŒ: Ù…ÛŒØ±Ø²Ø§ Ø¹Ù„ÛŒ â€¢ 
  <a href="https://t.me/mirza.ali.official" target="_blank"><img src="https://img.icons8.com/color/48/telegram-app.png" alt="telegram"> @mirza.ali.official</a>
  <a href="https://instagram.com/mirza.ali.official" target="_blank"><img src="https://img.icons8.com/color/48/instagram-new.png" alt="instagram"> @mirza.ali.official</a>
</div>

<script>
let users = JSON.parse(localStorage.getItem('ph_users') || '[]');
let drugs = JSON.parse(localStorage.getItem('ph_drugs') || '[]');
let reports = JSON.parse(localStorage.getItem('ph_reports') || '[]');
const DEF = [['admin','admin123','admin'],['11','11','user']];
DEF.forEach(u=>{if(!users.some(x=>x.username==u[0]))users.push({username:u[0],password:u[1],role:u[2]})});
localStorage.setItem('ph_users',JSON.stringify(users));

let currentUser = null;

function show(id){
  document.querySelectorAll('.box').forEach(b=>b.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function login(){
  const u = document.getElementById('login-username').value.trim();
  const p = document.getElementById('login-password').value.trim();
  const user = users.find(x => x.username === u && x.password === p);
  if(!user){ alert('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª'); return; }
  currentUser = user;
  document.getElementById('admin-reports-btn').classList.toggle('hidden', user.role !== 'admin');
  document.getElementById('add-user-btn').classList.toggle('hidden', user.role !== 'admin');
  show('main-menu');
  loadDrugs();
}

function logout(){ currentUser = null; show('home-page'); }

function addUser(){
  const username = document.getElementById('new-username').value.trim();
  const password = document.getElementById('new-password').value.trim();
  const role     = document.getElementById('new-role').value;
  if(!username || !password){ alert("Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯"); return; }
  if(users.some(u=>u.username === username)){ alert("Ú©Ø§Ø±Ø¨Ø± ØªÚ©Ø±Ø§Ø±ÛŒ Ø§Ø³Øª"); return; }
  users.push({username, password, role});
  localStorage.setItem('ph_users', JSON.stringify(users));
  alert("Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø§ÙØ²ÙˆØ¯Ù‡ Ø´Ø¯");
  show('main-menu');
}

document.getElementById('drug-form').onsubmit = e => {
  e.preventDefault();
  drugs.push({
    name: document.getElementById('name').value.trim(),
    quantity: +document.getElementById('quantity').value,
    minQuantity: +document.getElementById('minQuantity').value,
    expiry: document.getElementById('expiry').value
  });
  localStorage.setItem('ph_drugs', JSON.stringify(drugs));
  e.target.reset();
  loadDrugs();
};

function loadDrugs(){
  const tb = document.getElementById('drug-table'); tb.innerHTML = '';
  const now = new Date();
  const sorted = [...drugs].sort((a, b) => a.name.localeCompare(b.name));
  sorted.forEach((d, i) => {
    const isLow = d.quantity < d.minQuantity;
    const isExp = new Date(d.expiry) < now;
    let statusTxt = 'Ø³Ø§Ù„Ù…', statusCls = '';
    
    if (isLow && isExp) {
      statusTxt = 'Ú©Ø³Ø±ÛŒ + Ø§Ù†Ù‚Ø¶Ø§';
      statusCls = 'statusBoth';
    } else if (isLow) {
      statusTxt = 'Ú©Ø³Ø±ÛŒ Ø¯Ø§Ø±Ùˆ';
      statusCls = 'statusLow';
    } else if (isExp) {
      statusTxt = 'Ø§Ù†Ù‚Ø¶Ø§';
      statusCls = 'statusExpired';
    }

    tb.insertAdjacentHTML('beforeend', `
      <tr>
        <td>${d.name}</td>
        <td>${d.quantity}</td>
        <td>${d.minQuantity}</td>
        <td>${d.expiry}</td>
        <td class="${statusCls}">${statusTxt}</td>
        <td>${currentUser?.role === 'admin' ? `<button onclick="delDrug(${i})">Ø­Ø°Ù</button>` : '-'}</td>
      </tr>`);
  });
}

function delDrug(i){
  drugs.splice(i, 1);
  localStorage.setItem('ph_drugs', JSON.stringify(drugs));
  loadDrugs();
}

function loadReports(){
  const tb = document.getElementById('reports-table'); tb.innerHTML = '';
  const sorted = [...reports].sort((a,b)=>new Date(b.time)-new Date(a.time));
  sorted.forEach(r => {
    tb.insertAdjacentHTML('beforeend', `<tr><td>${r.fname}</td><td>${r.lname}</td><td>${r.text}</td><td>${r.time}</td></tr>`);
  });
}

function exportReports(){
  const csv = 'Ù†Ø§Ù…,Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ,Ù…ØªÙ†,Ø²Ù…Ø§Ù†\n' + reports.map(r => `${r.fname},${r.lname},"${r.text}",${r.time}`).join('\n');
  const blob = new Blob([csv], {type: 'text/csv;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'reports.csv';
  a.click();
}

function submitReport(){
  const fname = document.getElementById('fname').value.trim();
  const lname = document.getElementById('lname').value.trim();
  const text  = document.getElementById('reportText').value.trim();
  if(!fname || !lname || !text){ alert('Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯'); return; }
  const time = new Date().toLocaleString('fa-IR');
  reports.push({ fname, lname, text, time });
  localStorage.setItem('ph_reports', JSON.stringify(reports));
  alert('âœ… Ú¯Ø²Ø§Ø±Ø´ Ø«Ø¨Øª Ø´Ø¯');
  document.getElementById('fname').value = '';
  document.getElementById('lname').value = '';
  document.getElementById('reportText').value = '';
  show('home-page');
}

show('home-page');
</script>
</body>
</html>